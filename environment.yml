# ==========================================================================
# Paediatric Simulation AI Feedback Pipeline â€” Conda Environment
# ==========================================================================
#
# Create:   conda env create -f environment.yml
# Activate: conda activate paed-sim-pipeline
# Update:   conda env update -f environment.yml --prune
#
# Note: PyTorch and ffmpeg are installed via conda for proper CUDA/system
#       library support. Everything else comes from pip.
# ==========================================================================

name: paed-sim-pipeline
channels:
  - pytorch
  - nvidia
  - conda-forge
  - defaults

dependencies:
  # ---- Python ----
  - python=3.11

  # ---- System libraries (conda handles these better than pip) ----
  - ffmpeg                          # Audio/video processing (ffprobe + ffmpeg)
  - cairo                           # Required by weasyprint for PDF rendering
  - pango                           # Required by weasyprint for text layout
  - gdk-pixbuf                      # Required by weasyprint for image handling
  - gobject-introspection           # Required by weasyprint

  # ---- PyTorch with CUDA (change to cpuonly if no GPU) ----
  - pytorch>=2.1
  - torchaudio>=2.1
  - pytorch-cuda=12.1               # Match your CUDA version; use "cpuonly" if no GPU
  # For CPU-only machines, replace the two lines above with:
  # - pytorch>=2.1
  # - torchaudio>=2.1
  # - cpuonly

  # ---- Scientific computing ----
  - numpy>=1.24
  - scipy>=1.11
  - pandas>=2.1
  - scikit-learn>=1.3
  - statsmodels>=0.14

  # ---- Visualization ----
  - matplotlib>=3.8
  - seaborn>=0.13

  # ---- Dev tools ----
  - pytest>=7.4
  - pytest-cov>=4.1
  - git                              # For freeze manifest commit hash

  # ---- Pip-only packages ----
  - pip
  - pip:
      # Core
      - pyyaml>=6.0
      - jinja2>=3.1

      # Stage 1: Ingestion
      - ffmpeg-python>=0.2.0

      # Stage 2: ASR
      - faster-whisper>=1.0.0
      - pyannote.audio>=3.1
      - huggingface-hub>=0.20

      # Stage 4: LLM
      - llama-cpp-python>=0.2.50

      # Stage 5: Report
      - weasyprint>=60.0

      # Dev
      - ruff>=0.3.0
